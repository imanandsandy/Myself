<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Scheduler</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { padding: 20px; }
        .form-control { margin-bottom: 10px; }
        .btn-primary { width: 100%; }
        table { margin-top: 20px; }
        .btn-danger, .btn-info { margin-right: 10px; }
    </style>
    <script>
        function loadConfigTasks() {
            var selectedConfig = document.getElementById("configSelector").value;
            if (!selectedConfig) return;

            fetch("{{ base_url }}/view/" + selectedConfig)
                .then(response => response.json())
                .then(tasks => {
                    let tableBody = document.getElementById("tasksTableBody");
                    tableBody.innerHTML = "";

                    tasks.forEach(task => {
                        tableBody.innerHTML += `
                            <tr>
                                <td>${task.name}</td>
                                <td>${task.command}</td>
                                <td>${task.cron}</td>
                                <td>
                                    <a href="{{ base_url }}/delete/${selectedConfig}/${task.name}" class="btn btn-danger">Delete</a>
                                </td>
                            </tr>`;
                    });
                });
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Task Scheduler</h1>

        <label for="configSelector">Select Config File:</label>
        <select id="configSelector" class="form-control" onchange="loadConfigTasks()">
            <option value="">-- Select a Config File --</option>
            {% for config in configs.keys() %}
                <option value="{{ config }}">{{ config }}</option>
            {% endfor %}
        </select>

        <h3>Scheduled Tasks</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Command</th>
                    <th>Cron Expression</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tasksTableBody">
                <!-- Tasks will be dynamically loaded here -->
            </tbody>
        </table>

        <h3>Completed Jobs</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Command</th>
                    <th>Cron Expression</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for job in completed_jobs %}
                <tr>
                    <td>{{ job.name }}</td>
                    <td>{{ job.command }}</td>
                    <td>{{ job.cron }}</td>
                    <td class="{% if job.status == 'Success' %}text-success{% elif job.status == 'Failed' %}text-danger{% else %}text-warning{% endif %}">
                        {{ job.status }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>
